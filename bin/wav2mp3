#!/bin/bash

FIND=`type -p gfind || type -p find`
XARGS=`type -p gxargs || type -p xargs`

CORES=${1:-4}

SELF=`basename "$0"`

case $SELF in

	wav2mp3)
		$FIND . -name '*.wav' -print0 | $XARGS -0 -n 1 -P $CORES bash -c 'echo "${0}"; lame -S -b 320 "${0}" "${0/.wav/.mp3}" 2>&1 1>/dev/null'
		;;

	wav2flac)
		$FIND . -name '*.wav' -print0 | $XARGS -0 -n 1 -P $CORES bash -c 'echo "${0}"; flac -s -o "${0/.wav/.flac}" "${0}" 2>&1 1>/dev/null'
		;;

	flac2wav)
		$FIND . -name '*.flac' -print0 | $XARGS -0 -n 1 -P $CORES bash -c 'echo "${0}"; flac -s -d -o "${0/.flac/.wav}" "${0}" 2>&1 1>/dev/null'
		;;

	aac2wav)
		$FIND . -name '*.aac' -print0 | $XARGS -0 -n 1 -P $CORES bash -c 'echo "${0}"; faad -q "${0}" -o "${0/.aac/.wav}" 2>&1 1>/dev/null'
		;;

	m4a2wav)
		$FIND . -name '*.m4a' -print0 | $XARGS -0 -n 1 -P $CORES bash -c 'echo "${0}"; faad -q "${0}" -o "${0/.m4a/.wav}" 2>&1 1>/dev/null'
		;;

	png2jpg)
		$FIND . -name '*.png' -print0 | $XARGS -0 -n 1 -P $CORES bash -c 'echo "${0}"; convert "${0}" "${0/.png/.jpg}" 2>&1 1>/dev/null'
		;;

esac

